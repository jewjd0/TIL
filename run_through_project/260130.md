# Python을 활용한 데이터 수집과 전처리
## 관통 프로젝트 소개
### 목표
- 1학기 마지막 월말평가(최종 관통 프로젝트)를 위한 준비
- 개인 포폴
- 협업 과정 학습
- branch로 협업 방법 학습
- 지금 실수해야 월말평가때 편함
- README 작성법
  - 오답노트로 사용
## Requests
- pip 공식문서 많이 참조하게 될 것
- HTTP 요청을 보내고 응답을 받는 라이브러리
- 설치: pip install requests
- 설치하면 물리적으로 다운받아짐 -> import로 경로 찾아서 사용
- ctrl + 클릭으로 소스코드 확인 가능
### 주요 기능
- GET, POST, PUT, DELETE 등 다양한 HTTP 메서드 지원
- jsonplaceholder에 get요청 보내기
  - jsonplaceholder: 테스트용 가짜 API 제공 사이트
```python
import requests
response = requests.get('https://jsonplaceholder.typicode.com/todos/')
print(response)
```
- 응답 결과
```
<Response [200]> //요청 성공
```
- 뒤에 .json() 붙이면 json형태 응답 데이터만 출력
- ++ 실행버튼 쓸거면 어떻게 작동하는지 알아보기
- 터미널 현재위치 확인하고 쓰기. 웬만하면 터미널 명령어로 실행해보자. 
- 필요한 데이터만 출력하기
```python
for item in response:
    if item['completed']:
        print(item)
```
- completed 중에 id랑 title만 출력하기
```python
# id와 title만 남긴 새 리스트 만들기
completed_items=[]
fields = ['id', 'title']
for item in response: 
    if item['completed']: # completed가 True인 항목만 출력
        temp_item = {}
        for key in fields:
            temp_item[key] = item[key] # id, title있는 임시 딕셔너리 생성
        completed_items.append(temp_item) # 다 만들어진 임시 딕셔너리 completed_items 리스트에 추가
print(completed_items)
```
- 작성자 정보를 포함한 데이터로 수정한다면?
  - todo의 id와 users의 id가 일치하는 항복을 찾아서 작성자 정보 추가
  - todo별 userID가 일치하는 user정보 중 필요 데이터만 추출해서 삽입<br>
  -> 필요 정보를 위해 몇 번의 요청이 필요한가? => 2번
  - todos가 200개라고 해도 요청은 한번이면 됨
- 메소드: get, post, put, head, delete, options, patch등 있다는 것 기억하기
## 참고
- pprint: 이쁘게 출력해주는 라이브러리
  - 주의: 예쁘게 보기 위한 것. 실제 로직과는 다르니 헷갈리지 말 것
  - 디스플레이 전에 키로 정렬되어 출력됨
  - 파이썬 딕셔너리는 순서를 보장하지 않는 자료구조이기 때문에 보이는것과 순서가 같을 거라 짐작하면 안됨.
  - for문으로 출력할 때는 순서가 다를 수 있음
## CSV
- 콤마로 구분된 값(Comma-Separated Values),데이터, 텍스트 파일
### 특징
- 단순한 형식
- 호환성: 거의 모든 스프레드시트 프로그램, 데이터베이스 시스템에서 지원
- 텍스트 기반: 텍스트 편집기로 쉽게 편집 가능
- vscode에서 rainbow csv extension 설치하면 편하게 볼 수 있음. 컬럼별로 색깔 다르게 표시
### 예시
```csv
이름,나이,직업
홍길동,30,개발자
김철수,25,디자이너
이영희,28,기획자
```
### ecoding
- excel에서 csv파일 열 때 인코딩 문제 발생 가능
- 데이터 -> 데이터 가져오기 -> 파일에서 -> 텍스트/ csv에서 -> 인코딩 utf-8 선택
- 원본 파일 작성 시 쉼표 기준 구분했으면 구분 기호 쉼표로 맞추기
### 파이썬에서 파일 다루기 - open함수
- open함수로 파일 열기
- open(filename, mode,[encoding])
  - mode: r(읽기, 기본값), w(쓰기, 기존 파일 덮어씀), a(추가, 기존 파일 뒤에 내용 추가)
  - encoding은 utf-8로 지정하는게 좋음
  - with문 사용시 자동으로 파일 닫아줌
- with문이란?
  - 리소스 자동 해제
  - 파일 작업, 네트워크 연결, 스레드 락 등에 사용
  - 코드 간결성, 가독성 향상
```python
with open('example.txt', 'r', encoding='utf-8') as file:
  # file이라는 변수에 open한 파일 객체 할당
    content = file.read()
    # read로 파일 내용 읽어서 content 변수에 저장
    print(content)
# with문 종료시 리소스 해제
```
- open을 통해 파일을 열어 둔 상태면 input은 열어 둔 파일에서 데이터를 읽어옴
### CSV 파일 읽기
- csv 모듈 사용
```python
import csv
with open('users.csv', 'r', encoding='utf-8') as file:
    csv_reader = csv.reader(file)
    for row in csv_reader:
        print(row)
```
- 결과
```
['이름', '나이', '직업']
['홍길동', '30', '개발자']
['김철수', '25', '디자이너']
['이영희', '28', '기획자']
```
- 첫 행을 열 이름으로 사용함
- dictreader 사용
```python
with open('users.csv', 'r', encoding='utf-8') as file:
    csv_reader = csv.DictReader(file)
    for row in csv_reader:
        print(row)
```
- => 각 행을 딕셔너리로 변환하여 읽어옴
- 첫 번째 행은 열 이름으로 사용
- 결과
```text
{'이름': '홍길동', '나이': '30', '직업': '개발자'}
{'이름': '김철수', '나이': '25', '직업': '디자이너'}
{'이름': '이영희', '나이': '28', '직업': '기획자'}
```
## CSV 파일 쓰기
### newline 매개변수
- open함수 매개변수 
  - newline 안하면 행 사이에 빈 줄 생김
```python
with open('data.csv', mode='w', encoding='utf-8') as file:
    csv_writer = csv.writer(file)  
    csv_writer.writerow(['이름', '나이', '직업'])
    csv_writer.writerow(['홍길동', 30, '개발자'])
    csv_writer.writerow(['김철수', 25, '디자이너'])
    csv_writer.writerow(['이영희', 28, '기획자'])
```
```
이름,나이,직업

홍길동,30,개발자

김철수,25,디자이너

이영희,28,기획자
```
- CRLF : 캐리지 리턴 + 라인 피드
  - git에서 나오는 lf will be replaced by crlf 경고문
  - 윈도우는 줄바꿈 문자로 CRLF(\r\n) 사용
  - 유닉스/리눅스/맥은 LF(\n) 사용
  - 깃이 알아 처리해줌
- newline : 파일에서 새로운 줄 처리하는 방식 지정
  - none: 기본 동작, 플랫폼에 따라 다름
  - '': 줄바꿈 문자 변환 안함
  - '\n': 모든 줄바꿈 문자를 LF로 변환
  - '\r\n': 모든 줄바꿈 문자를 CRLF로 변환
  - '\r': 모든 줄바꿈 문자를 CR로 변환
  - 다양한 운영체제 간의 줄바꿈 문자 차이 처리
```python
with open('data.csv', mode='w', encoding='utf-8', newline='') as file:
    csv_writer = csv.writer(file)  
    csv_writer.writerow(['이름', '나이', '직업'])
    csv_writer.writerow(['홍길동', 30, '개발자'])
    csv_writer.writerow(['김철수', 25, '디자이너'])
    csv_writer.writerow(['이영희', 28, '기획자'])
```
```
이름,나이,직업
홍길동,30,개발자
김철수,25,디자이너
이영희,28,기획자
```
### DictWriter 사용
- fieldnames 매개변수로 열 이름 지정
```python
with open('data.csv', mode='w', encoding='utf-8', newline='') as file:
    fieldnames = ['이름', '나이', '직업']
    csv_writer = csv.DictWriter(file, fieldnames=fieldnames)
    csv_writer.writeheader()  # 열 이름 작성
    csv_writer.writerow({'이름': '홍길동', '나이': 30, '직업': '개발자'})
    csv_writer.writerow({'이름': '김철수', '나이': 25, '직업': '디자이너'})
    csv_writer.writerow({'이름': '이영희', '나이': 28, '직업': '기획자'})
```
- json으로 받아온 값 csv로 저장할 때 유용
- for문 돌면서 하나씩 작성 가능
- 코드는 05_export_csv.py에 있음