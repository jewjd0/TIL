# Realtionships
## Many to one realationship
### 개요
- Many to one realationship : 한 테이블의 0개 이상의 레코드가 다른 테이블의 레코드 한 개와 관련된 관계
  - N : 1 or 1 : N 관계
- 예시) 댓글 - 게시글
  - 0개 이상의 댓글이 하나의 게시글에 작성될 수 있음
- N쪽의 테이블에서 외래 키를 이용하여 참조. 
- article만 봤을 때는 댓글이 몇 개 달렸는지, 뭐가 있는지 모름. 그렇다고 article에 참조 값을 넣을 수는 없음. 댓글이 달릴 때마다 article이 업데이트 되어야 하는데 그건 비효율적.
- 댓글 테이블에서 article 관련 필터링을 해서 찾아내는 것도 비효율. 
  -> 어떻게 해결할 것인가?
### 댓글 모델
- ForeignKey() : N:1 관계 설정 모델 필드
### 댓글 모델 정의 
- ForeignKey클래스의 인스턴스 이름은 참조하는 모델 클래스 이름의 단수형으로 작성하는 것 권장
- 외래 키는 ForeignKey클래스를 작성하는 위치와 관계없이 테이블 필드 마지막에 생성
## 강의 첨언
- serializer에서 partial=(request.method == 'PATCH') -> PATCH 방식으로 요청이 들어오면 partial 업데이트 허용
- 01에서 serializer.py 참고
    - ```json
        {
        "id": 2,
        "article": {
            "id": 1,
            "title": "제목3"
        },
        "content": "댓글2 생성",
        "created_at": "2026-02-26T01:09:28.024318Z",
        "updated_at": "2026-02-26T01:09:28.024318Z"
        }
        ```
- comment의 get, put, delete는 알아해라. 인수만 article에 comment 추가로 받으면 됨

- 1의 입장인 article는 본인을 참조하고 있는 댓글들을 역참조할 수 있음 -> 매니저를 통해
  - 역참조 매니저 : (나를 참조하는 모델명 소문자)_set

## Many to many relationship
- 예시 : 강의 - 강사
- 하나의 강의는 여러 명의 강사가 가르칠 수 있고, 하나의 강사는 여러 개의 강의를 가르칠 수 있음
- Many to many relationship : 한 테이블의 0개 이상의 레코드가 다른 테이블의 0개 이상의 레코드와 관련된 관계
  - N : M or M : N 관계
- 1:N에서는 foreign key로 참조하는 테이블이 N쪽에 있었지만, N:M에서는 양쪽 모두가 서로를 참조해야 함
- 서로 역참조 매니저를 사용? ManytoManyField가 존재. 
- through 옵션 : 중간 테이블을 명시적으로 정의하여 Many to many relationship 설정
  - 중간 테이블 : 두 테이블 간의 관계를 나타내는 별도의 테이블
- 다대다 관계에서 역참조 매니저는 기본적으로 파이쎤에서 사용하기 위한 필드. 실제 데이터베이스에서는 중간 테이블이 생성됨.
- serializer에서는 1:N 처리하듯이 가져옴. many=True 옵션 사용하여 여러 개의 객체를 처리할 수 있도록 설정
- 대신 저장할 때 서로 참조를 이미 하고 있을수도 있고 원래 있던 애가 관계를 맺게 되는 경우도 있어서 주의. remove, add로 관리하게 됨. 근데 해당 문법은 파이썬 문법인데 유사 리스트 형식으로 관리하는 것.
- 다대다 모델 만들때 중개모델 만들거면 신경써서 만들어라. 뭘 저장할거고 어떻게 연결할건지 고민해봐야 함.
- get_object_or_404() : 객체를 가져오거나, 객체가 존재하지 않을 경우 404 에러 반환하는 함수
  - 그냥 get함수는 객체가 없거나 여러 개이면 에러 반환해서 404 에러로 반환하기 위해 get_object_or_404() 사용. django.shortcuts 모듈에서 제공하는 함수
- 다른 앱의 시리얼라이저도 당연히 가져와서 작업할 수 있음.

- 오늘강의는 진짜 다시들어야함 뒷부분 30분은 못들음;

- 서로 다른 m:n 테이블을 정의할 때 중간 테이블에서 foreign key를 각각 받아와서 연결한다..?
- 오늘 진짜 뭔지모르겠네;;